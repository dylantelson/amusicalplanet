{"ast":null,"code":"import _regeneratorRuntime from\"/home/dylan/MusicGuessr/a-musical-planet/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/dylan/MusicGuessr/a-musical-planet/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/dylan/MusicGuessr/a-musical-planet/node_modules/@babel/runtime/helpers/esm/slicedToArray\";//import \"./App.css\";\nimport React,{useState,useEffect,useContext}from\"react\";import{BrowserRouter as Router,Switch,Route,Redirect}from\"react-router-dom\";import\"./App.css\";import axios from\"axios\";import Play from\"./Play\";import Header from\"./Header\";import Login from\"./Login\";import ChooseMap from\"./ChooseMap\";import Leaderboard from\"./Leaderboard\";import PersonalPage from\"./PersonalPage\";import dotenv from\"dotenv\";import getCookie from\"./GetCookie\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";dotenv.config();export var UserContext=/*#__PURE__*/React.createContext({userName:\"user\",displayName:\"user\",stats:{maxScores:{},averageScores:{},completedGames:0}});function App(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),accessToken=_useState2[0],setAccessToken=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),redirect=_useState4[0],setRedirect=_useState4[1];var _useState5=useState({displayName:\"\",userName:\"\",maxScores:{},profilePicture:\"\",country:\"\"}),_useState6=_slicedToArray(_useState5,2),userData=_useState6[0],setUserData=_useState6[1];//default world as map\nvar _useState7=useState(\"world\"),_useState8=_slicedToArray(_useState7,2),currMap=_useState8[0],setCurrMap=_useState8[1];var sendScoreToServer=function sendScoreToServer(newScore){console.log(\"Sending score to server\",newScore);axios(\"\".concat(process.env.REACT_APP_BACKEND_URI,\"/newScore/\").concat(userData.userName,\"/\").concat(currMap,\"/\").concat(newScore),{method:\"POST\"}).then(function(_ref){var data=_ref.data;console.log(\"Score sent to server!\");console.log(data);setUserData(data);}).catch(function(err){console.log(\"ERROR SENDING SCORE TO SERVER\",err);});};var setTokenFromCookie=function setTokenFromCookie(){var accessTokenCookie=getCookie(\"accessToken\");console.log(\"myCookie\",accessTokenCookie);if(accessTokenCookie!==\"\"){console.log(\"GOT COOKIE!\",accessTokenCookie);setAccessToken(accessTokenCookie);return true;}else{console.log(\"Could not find cookie\");return false;}};useEffect(function(){console.log(accessToken);if(accessToken!==\"\"&&accessToken!==null){console.log(\"UseEffect setting user with accesstoken\",accessToken);setUser();}else{console.log(\"No access token with which to set user\");}},[accessToken]);var setUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"SETTING USER\");return _context.abrupt(\"return\",axios(\"https://api.spotify.com/v1/me\",{headers:{Accept:\"application/json\",// \"Content-Type\": \"application/json\",\nAuthorization:\"Bearer \"+accessToken},method:\"GET\"}).then(function(spotifyData){axios(\"\".concat(process.env.REACT_APP_BACKEND_URI,\"/userData/\").concat(spotifyData.data.id),{headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\"},method:\"GET\"}).then(function(_ref3){var data=_ref3.data;setUserData(data);});}).catch(function(err){console.log(\"ERROR GETTING SPOTIFY USER DATA\",err);if(err.response.status>=400){console.log(\"ERROR 400+, REFRESHING TOKEN\");window.location.replace(\"\".concat(process.env.REACT_APP_BACKEND_URI,\"/getNewToken\"));}}));case 2:case\"end\":return _context.stop();}}},_callee);}));return function setUser(){return _ref2.apply(this,arguments);};}();var handleMapChosen=function handleMapChosen(mapName){if(accessToken===null||accessToken===\"\"){alert(\"ACCESS NOT NULL?\");if(!setTokenFromCookie())return setRedirect(\"login\");}console.log(\"HANDLING MAP CHOSEN\");setCurrMap(mapName[0].toLowerCase()+mapName.slice(1).replaceAll(\" \",\"\"));// setRedirect(\"play\");\n};var checkToken=function checkToken(){if(!setTokenFromCookie()){alert(\"CHECKIN TOKEN\");setRedirect(\"login\");}};var handleLogin=function handleLogin(){window.location.replace(\"\".concat(process.env.REACT_APP_BACKEND_URI,\"/login\"));};var setAccessTokenHandler=function setAccessTokenHandler(newAccessToken){var accessTokenExpireDate=new Date();accessTokenExpireDate.setTime(accessTokenExpireDate.getTime()+3600*1000);var refreshTokenExpireDate=new Date();refreshTokenExpireDate.setTime(refreshTokenExpireDate.getTime()+3600*1000*24*365);document.cookie=\"accessToken=\"+newAccessToken+\";expires=\"+accessTokenExpireDate.toUTCString()+\";path=/\";setAccessToken(newAccessToken);};var handleAuth=function handleAuth(){// console.log(accessToken === \"\");\n// if (accessToken !== \"\" && accessToken !== null) {\n//   console.log(\"have access token\", accessToken);\n//   return setRedirect(\"maps\");\n// }\n// if (setTokenFromCookie()) {\n//   console.log(\"gettin from cookie\");\n//   return setRedirect(\"maps\");\n// }\nconsole.count(\"Handling AUTH\");var URLAccessToken=new URLSearchParams(window.location.search).get(\"access_token\");var URLRefreshToken=new URLSearchParams(window.location.search).get(\"refresh_token\");setAccessTokenHandler(URLAccessToken);// return <Redirect to=\"/maps\" />;\nsetRedirect(\"maps\");};return/*#__PURE__*/_jsx(\"div\",{className:\"app\",children:/*#__PURE__*/_jsxs(Router,{children:[redirect===\"play\"&&window.location.pathname===\"/maps\"?/*#__PURE__*/_jsx(Redirect,{to:\"play\",replace:true}):null,redirect===\"maps\"?/*#__PURE__*/_jsx(Redirect,{to:\"/maps\"}):null,redirect===\"login\"?/*#__PURE__*/_jsx(Redirect,{to:\"/login\"}):null,/*#__PURE__*/_jsxs(UserContext.Provider,{value:userData,children:[/*#__PURE__*/_jsx(Header// userData={userData}\n,{checkToken:checkToken,setRedirect:setRedirect}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/auth\",render:function render(){return handleAuth();}}),/*#__PURE__*/_jsx(Route,{path:\"/login\",render:function render(){return setTokenFromCookie()?/*#__PURE__*/_jsx(Redirect,{to:\"/maps\"}):handleLogin();}}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:document.cookie===\"\"?/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin}):/*#__PURE__*/_jsx(Redirect,{to:\"/login\"})}),/*#__PURE__*/_jsx(Route,{path:\"/maps\",children:/*#__PURE__*/_jsx(ChooseMap,{handleMapChosen:handleMapChosen})}),/*#__PURE__*/_jsx(Route,{path:\"/leaderboard\",children:/*#__PURE__*/_jsx(Leaderboard,{})}),/*#__PURE__*/_jsx(Route,{path:\"/user/:userName\",children:/*#__PURE__*/_jsx(PersonalPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/play\",children:/*#__PURE__*/_jsx(Play,{accessToken:accessToken,token:accessToken,currMap:currMap,setAccessTokenHandler:setAccessTokenHandler,setTokenFromCookie:setTokenFromCookie,sendScoreToServer:sendScoreToServer})}),/*#__PURE__*/_jsx(Route,{path:\"/error\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Error! Check console\"})}),/*#__PURE__*/_jsx(Route,{path:\"*\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Not Found!\"})})]})]})]})});}export default App;","map":{"version":3,"sources":["/home/dylan/MusicGuessr/a-musical-planet/src/App.js"],"names":["React","useState","useEffect","useContext","BrowserRouter","Router","Switch","Route","Redirect","axios","Play","Header","Login","ChooseMap","Leaderboard","PersonalPage","dotenv","getCookie","config","UserContext","createContext","userName","displayName","stats","maxScores","averageScores","completedGames","App","accessToken","setAccessToken","redirect","setRedirect","profilePicture","country","userData","setUserData","currMap","setCurrMap","sendScoreToServer","newScore","console","log","process","env","REACT_APP_BACKEND_URI","method","then","data","catch","err","setTokenFromCookie","accessTokenCookie","setUser","headers","Accept","Authorization","spotifyData","id","response","status","window","location","replace","handleMapChosen","mapName","alert","toLowerCase","slice","replaceAll","checkToken","handleLogin","setAccessTokenHandler","newAccessToken","accessTokenExpireDate","Date","setTime","getTime","refreshTokenExpireDate","document","cookie","toUTCString","handleAuth","count","URLAccessToken","URLSearchParams","search","get","URLRefreshToken","pathname"],"mappings":"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","sourcesContent":["//import \"./App.css\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect,\n} from \"react-router-dom\";\n\nimport \"./App.css\";\nimport axios from \"axios\";\nimport Play from \"./Play\";\nimport Header from \"./Header\";\nimport Login from \"./Login\";\nimport ChooseMap from \"./ChooseMap\";\nimport Leaderboard from \"./Leaderboard\";\nimport PersonalPage from \"./PersonalPage\";\nimport dotenv from \"dotenv\";\nimport getCookie from \"./GetCookie\";\n\ndotenv.config();\n\nexport const UserContext = React.createContext({\n  userName: \"user\",\n  displayName: \"user\",\n  stats: {\n    maxScores: {},\n    averageScores: {},\n    completedGames: 0,\n  },\n});\n\nfunction App() {\n  const [accessToken, setAccessToken] = useState(\"\");\n  const [redirect, setRedirect] = useState(\"\");\n  const [userData, setUserData] = useState({\n    displayName: \"\",\n    userName: \"\",\n    maxScores: {},\n    profilePicture: \"\",\n    country: \"\",\n  });\n\n  //default world as map\n  const [currMap, setCurrMap] = useState(\"world\");\n\n  const sendScoreToServer = (newScore) => {\n    console.log(\"Sending score to server\", newScore);\n    axios(\n      `${process.env.REACT_APP_BACKEND_URI}/newScore/${userData.userName}/${currMap}/${newScore}`,\n      {\n        method: \"POST\",\n      }\n    )\n      .then(({ data }) => {\n        console.log(\"Score sent to server!\");\n        console.log(data);\n        setUserData(data);\n      })\n      .catch((err) => {\n        console.log(\"ERROR SENDING SCORE TO SERVER\", err);\n      });\n  };\n\n  const setTokenFromCookie = () => {\n    const accessTokenCookie = getCookie(\"accessToken\");\n    console.log(\"myCookie\", accessTokenCookie);\n    if (accessTokenCookie !== \"\") {\n      console.log(\"GOT COOKIE!\", accessTokenCookie);\n      setAccessToken(accessTokenCookie);\n      return true;\n    } else {\n      console.log(\"Could not find cookie\");\n      return false;\n    }\n  };\n\n  useEffect(() => {\n    console.log(accessToken);\n    if (accessToken !== \"\" && accessToken !== null) {\n      console.log(\"UseEffect setting user with accesstoken\", accessToken);\n      setUser();\n    } else {\n      console.log(\"No access token with which to set user\");\n    }\n  }, [accessToken]);\n\n  const setUser = async () => {\n    console.log(\"SETTING USER\");\n    return axios(\"https://api.spotify.com/v1/me\", {\n      headers: {\n        Accept: \"application/json\",\n        // \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + accessToken,\n      },\n      method: \"GET\",\n    })\n      .then((spotifyData) => {\n        axios(\n          `${process.env.REACT_APP_BACKEND_URI}/userData/${spotifyData.data.id}`,\n          {\n            headers: {\n              Accept: \"application/json\",\n              \"Content-Type\": \"application/json\",\n            },\n            method: \"GET\",\n          }\n        ).then(({ data }) => {\n          setUserData(data);\n        });\n      })\n      .catch((err) => {\n        console.log(\"ERROR GETTING SPOTIFY USER DATA\", err);\n        if (err.response.status >= 400) {\n          console.log(\"ERROR 400+, REFRESHING TOKEN\");\n          window.location.replace(\n            `${process.env.REACT_APP_BACKEND_URI}/getNewToken`\n          );\n        }\n      });\n  };\n\n  const handleMapChosen = (mapName) => {\n    if (accessToken === null || accessToken === \"\") {\n      alert(\"ACCESS NOT NULL?\");\n      if (!setTokenFromCookie()) return setRedirect(\"login\");\n    }\n    console.log(\"HANDLING MAP CHOSEN\");\n    setCurrMap(mapName[0].toLowerCase() + mapName.slice(1).replaceAll(\" \", \"\"));\n    // setRedirect(\"play\");\n  };\n\n  const checkToken = () => {\n    if (!setTokenFromCookie()) {\n      alert(\"CHECKIN TOKEN\");\n      setRedirect(\"login\");\n    }\n  };\n\n  const handleLogin = () => {\n    window.location.replace(`${process.env.REACT_APP_BACKEND_URI}/login`);\n  };\n\n  const setAccessTokenHandler = (newAccessToken) => {\n    let accessTokenExpireDate = new Date();\n    accessTokenExpireDate.setTime(\n      accessTokenExpireDate.getTime() + 3600 * 1000\n    );\n\n    let refreshTokenExpireDate = new Date();\n    refreshTokenExpireDate.setTime(\n      refreshTokenExpireDate.getTime() + 3600 * 1000 * 24 * 365\n    );\n\n    document.cookie =\n      \"accessToken=\" +\n      newAccessToken +\n      \";expires=\" +\n      accessTokenExpireDate.toUTCString() +\n      \";path=/\";\n\n    setAccessToken(newAccessToken);\n  };\n\n  const handleAuth = () => {\n    // console.log(accessToken === \"\");\n    // if (accessToken !== \"\" && accessToken !== null) {\n    //   console.log(\"have access token\", accessToken);\n    //   return setRedirect(\"maps\");\n    // }\n    // if (setTokenFromCookie()) {\n    //   console.log(\"gettin from cookie\");\n    //   return setRedirect(\"maps\");\n    // }\n    console.count(\"Handling AUTH\");\n    const URLAccessToken = new URLSearchParams(window.location.search).get(\n      \"access_token\"\n    );\n    const URLRefreshToken = new URLSearchParams(window.location.search).get(\n      \"refresh_token\"\n    );\n    setAccessTokenHandler(URLAccessToken);\n    // return <Redirect to=\"/maps\" />;\n    setRedirect(\"maps\");\n  };\n\n  return (\n    <div className=\"app\">\n      <Router>\n        {redirect === \"play\" && window.location.pathname === \"/maps\" ? (\n          <Redirect to=\"play\" replace />\n        ) : null}\n        {redirect === \"maps\" ? <Redirect to=\"/maps\" /> : null}\n        {redirect === \"login\" ? <Redirect to=\"/login\" /> : null}\n        <UserContext.Provider value={userData}>\n          <Header\n            // userData={userData}\n            checkToken={checkToken}\n            setRedirect={setRedirect}\n          />\n          <Switch>\n            <Route path=\"/auth\" render={() => handleAuth()} />\n            <Route\n              path=\"/login\"\n              render={() =>\n                setTokenFromCookie() ? <Redirect to=\"/maps\" /> : handleLogin()\n              }\n            />\n            <Route exact path=\"/\">\n              {document.cookie === \"\" ? (\n                <Login handleLogin={handleLogin} />\n              ) : (\n                <Redirect to=\"/login\" />\n              )}\n            </Route>\n            <Route path=\"/maps\">\n              <ChooseMap handleMapChosen={handleMapChosen} />\n            </Route>\n            <Route path=\"/leaderboard\">\n              <Leaderboard />\n            </Route>\n            <Route path=\"/user/:userName\" children={<PersonalPage />} />\n            <Route path=\"/play\">\n              <Play\n                accessToken={accessToken}\n                token={accessToken}\n                currMap={currMap}\n                setAccessTokenHandler={setAccessTokenHandler}\n                setTokenFromCookie={setTokenFromCookie}\n                sendScoreToServer={sendScoreToServer}\n              />\n            </Route>\n            <Route path=\"/error\">\n              <h1>Error! Check console</h1>\n            </Route>\n            <Route path=\"*\">\n              <h1>Not Found!</h1>\n            </Route>\n          </Switch>\n        </UserContext.Provider>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}